{% extends 'users/base.html' %}

{% block content %}
<div class="p-6 space-y-8">

    <!-- Top Metric Cards -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6">
  <!-- Scan card -->
  <a href="{% url 'scan_email' %}" class="card-soft p-6 flex items-center gap-5 hover:shadow-md transition">
    <div class="rounded-lg p-3" style="background: linear-gradient(180deg, rgba(233,78,163,0.12), rgba(155,87,243,0.06));">
      <i class="ri-mail-check-line text-3xl" style="color:#e94ea3"></i>
    </div>
    <div>
      <div class="text-sm text-slate-500">Scan Email</div>
      <div class="font-semibold text-lg">Start a new threat scan</div>
    </div>
  </a>

  <!-- Total Reports -->
  <div class="card-soft p-6 flex items-center gap-5">
    <div class="rounded-lg p-3" style="background: linear-gradient(180deg, rgba(155,87,243,0.12), rgba(155,87,243,0.06));">
      <i class="ri-bar-chart-fill text-3xl" style="color:#9b57f3"></i>
    </div>
    <div>
      <div class="text-sm text-slate-500">Total Reports</div>
      <div class="font-semibold text-2xl">{{ total_phishing }}</div>
    </div>
  </div>

  <!-- Accuracy -->
  <div class="card-soft p-6 flex items-center gap-5">
    <div class="rounded-lg p-3" style="background: linear-gradient(180deg, rgba(123,85,255,0.12), rgba(233,78,163,0.04));">
      <i class="ri-shield-check-line text-3xl" style="color:#7c3aed"></i>
    </div>
    <div>
      <div class="text-sm text-slate-500">Accuracy Score</div>
      <div class="font-semibold text-2xl">96{{ accuracy }}%</div>
    </div>
  </div>
</div>


    <!-- Chart + Activity Row -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

        <!-- Chart Card (takes 2 columns) -->
        <div class="lg:col-span-2 card bg-white p-6 border border-[#eee]">
            <h3 class="font-semibold mb-4">Threat Levels Distribution</h3>
            <canvas id="riskChart" width="400" height="200"></canvas>
        </div>

        <!-- Activity Feed -->
        <div class="card bg-white p-6 border border-[#eee]">
            <h3 class="font-semibold mb-4">Activity Feed</h3>
            {% if activities %}
                <ul class="space-y-3">
                    {% for act in activities %}
                        <li class="text-sm text-gray-700 border-b pb-2">{{ act }}</li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="text-sm text-gray-500">No recent activity</p>
            {% endif %}
        </div>

    </div>

    <!-- Recent Reports Table -->
    <div class="card bg-white p-6 border border-[#eee]">
        <h3 class="font-semibold mb-4">Recent Reports</h3>
        <table class="table w-full">
            <thead>
                <tr>
                    <th>Email</th>
                    <th>Risk</th>
                    <th>Date</th>
                </tr>
            </thead>
            <tbody>
                {% if recent_reports %}
                    {% for r in recent_reports %}
                    <tr>
                        <td>{{ r.email }}</td>
                        <td>{{ r.risk }}</td>
                        <td>{{ r.date }}</td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr><td colspan="3" class="text-center text-gray-400 py-4">No reports yet</td></tr>
                {% endif %}
            </tbody>
        </table>
    </div>

</div>
{% endblock %}

